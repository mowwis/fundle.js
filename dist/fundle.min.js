var Fundle=(()=>{var g=Object.defineProperty;var N=Object.getOwnPropertyDescriptor;var O=Object.getOwnPropertyNames;var x=Object.prototype.hasOwnProperty;var j=(n,t)=>{for(var e in t)g(n,e,{get:t[e],enumerable:!0})},A=(n,t,e,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of O(t))!x.call(n,i)&&i!==e&&g(n,i,{get:()=>t[i],enumerable:!(s=N(t,i))||s.enumerable});return n};var S=n=>A(g({},"__esModule",{value:!0}),n);var D={};j(D,{API:()=>l,Collection:()=>d,Component:()=>y,Model:()=>m,ModelEvent:()=>r,Router:()=>v,Templater:()=>f});var f=class{static clone(t){if(typeof t=="string"&&(t=document.querySelector(t)),!t||!(t instanceof HTMLTemplateElement))throw new Error(`Templater: No valid HTMLTemplateElement found for selector/input: ${t}`);return t.content.cloneNode(!0)}static bind(t,e){let s=i=>i.trim()===":this"?[t]:(i.trim().startsWith(":this")&&(i=i.replace(":this","")),t.querySelectorAll(i));Object.entries(e).forEach(([i,h])=>{i.split(/,(?![^(]*\))/g).map(c=>c.trim()).forEach(c=>{let E=c.match(/^(.*?)::([a-zA-Z]+)\s*(.*)$/);if(E){let[,a,p,w]=E,T=[a,w].join(" "),C=s(a);C.length>0?C.forEach(u=>{if(u._eventListeners||(u._eventListeners=new Set),!u._eventListeners.has(i)){let b=s(T)[0]||u;u.addEventListener(p,L=>h(b,L)),u._eventListeners.add(i)}}):console.warn(`Templater: Event target element(s) not found for base selector: "${a}"`)}else{let a=s(c);a.length>0?a.forEach(p=>h(p)):console.warn(`Templater: Data binding target element(s) not found for selector: "${c}"`)}})})}},v=class{static routes=[];static defaultPath="/";static route(t,e){this.routes.push({path:t,callback:e})}static go(t,e=!1){e?history.replaceState({},"",t):history.pushState({},"",t),this.#t(t)}static init(){this.#t(),window.addEventListener("popstate",()=>this.#t())}static#t(t){let e=this.#s(t||window.location.pathname);if(!e)return this.go(this.defaultPath,!0);e.callback(e.params,e.queryParams)}static#s(t){for(let e of this.routes){let s=this.#i(t,e.path);if(s)return{...e,params:s.params,queryParams:s.queryParams}}return null}static#i(t,e){let[s,i]=t.split("?"),h=new URLSearchParams(i),o=s.split("/").filter(Boolean),c=e.split("/").filter(Boolean);if(o.length!==c.length)return null;let E={};for(let a=0;a<o.length;a++)if(c[a].startsWith(":")){let p=c[a].slice(1);E[p]=o[a]}else if(o[a]!==c[a])return null;return{params:E,queryParams:h}}},l=class{static baseUrl="/api";static set baseUrl(t){this.baseUrl=t}static async request(t,e={}){var s=(t.startsWith("/")?this.baseUrl:"")+t;["DELETE","PATCH"].includes(e.method)||(s=s.endsWith("/")?s:s+"/");let i=await fetch(s,{headers:{"Content-Type":"application/json"},...e});if(!i.ok)throw new Error(`API Error: ${i.status} - ${await i.text()}`);return i.json()}static get(t){return this.request(t)}static post(t,e){return this.request(t,{method:"POST",body:JSON.stringify(e)})}static patch(t,e){return this.request(t,{method:"PATCH",body:JSON.stringify(e)})}static delete(t){return this.request(t,{method:"DELETE"})}static postFile(t,e){return this.request(t,{method:"POST",body:e,headers:{}})}};var m=class extends EventTarget{static fields={};static endpoint=null;static _instanceCache;static _classEventTarget;fieldChanges={};get changeDelta(){return Object.entries(this.fieldChanges).reduce((t,[e,s])=>(t[e]=s.newValue,t),{})}constructor(t={}){super(),this.constructor._instanceCache===void 0&&(this.constructor._instanceCache=new Map),this.constructor._classEventTarget===void 0&&(this.constructor._classEventTarget=new EventTarget),this.#t();let e=t[this.constructor.primaryField];if(e&&this.constructor._instanceCache.has(e)){let s=this.constructor._instanceCache.get(e);return s.assign(t),s}this.assign(t)}#t(){Object.entries(this.constructor.fields).forEach(([t,e])=>{var s;typeof e=="object"?{type:s}=e:s=e;let i=`#${t}`;this[i]=void 0,Object.defineProperty(this,t,{get(){return this[i]},set(h){let o=this[i];this[i]=this.constructor._castFieldValue(h,s),this[i]!==o&&(this.fieldChanges[t]?this.fieldChanges[t].newValue=h:this.fieldChanges[t]={oldValue:o,newValue:h})},enumerable:!0,configurable:!0})})}static async all(t={}){let e;if(this._instanceCache===void 0&&(this._instanceCache=new Map),!this.endpoint)e=[...this._instanceCache.values()];else{var s=this.endpoint;Object.entries(t).forEach(([i,h])=>s=s.replace(`:${i}`,String(h))),e=await l.get(s)}return new d(this).fromArray(e)}async save(){if(!this.endpoint)return this.assign();let t;this.primaryKey?Object.keys(this.fieldChanges).length&&(t=await l.patch(`${this.endpoint}/${this.primaryKey}`,this.changeDelta)):t=await l.post(this.endpoint,this),t&&this.assign(t)}revert(...t){Object.keys(this.fieldChanges).length&&(Object.entries(this.fieldChanges).forEach(([e,s])=>{t.length!=0&&!t.includes(e)||(this[e]=s.oldValue,delete this.fieldChanges[e])}),this.dispatchEvent(r.change(this,this.changeDelta)))}async delete(){this.primaryKey&&this.constructor._instanceCache.delete(this.primaryKey),this.primaryKey&&this.endpoint&&await l.delete(`${this.endpoint}/${this.primaryKey}`);let t=r.delete(this);this.dispatchEvent(t),this.constructor.dispatchEvent(t)}assign(t={}){Object.keys(this.constructor.fields).forEach(s=>{s in t&&(this[s]=t[s])});let e=t[this.constructor.primaryField];e&&!this.constructor._instanceCache.has(e)&&(this.constructor._instanceCache.set(e,this),this.constructor.dispatchEvent(r.new(this))),Object.keys(this.fieldChanges).length&&this.dispatchEvent(r.change(this,this.changeDelta)),this.fieldChanges={}}get endpoint(){if(this.constructor.endpoint){var t=this.constructor.endpoint;return Object.keys(this.constructor.fields).forEach(e=>{t=t.replace(`:${e}`,String(this[e]))}),t}}get primaryKey(){return this[this.constructor.primaryField]}static get primaryField(){let t=Object.keys(this.fields).find(e=>this.fields[e].primaryKey);if(t)return t;if("id"in this.fields)return"id";throw new Error("Model must have a primary key or 'id' field defined.")}static dispatchEvent(t){this._classEventTarget===void 0&&(this._classEventTarget=new EventTarget),this._classEventTarget.dispatchEvent(t)}static addEventListener(t,e){this._classEventTarget===void 0&&(this._classEventTarget=new EventTarget),this._classEventTarget.addEventListener(t,e)}static removeEventListener(t,e){this._classEventTarget===void 0&&(this._classEventTarget=new EventTarget),this._classEventTarget.removeEventListener(t,e)}static _castFieldValue(t,e){if(t==null)return t;switch(e){case Date:return new Date(t);case Number:case String:case Boolean:return e(t);default:return t}}toJSON(){let t={};return Object.keys(this.constructor.fields).forEach(e=>{let s=this[e];s!=null&&(t[e]=s instanceof Date?s.toISOString():s)}),t}},r=class n extends CustomEvent{static NEW="new";static CHANGE="change";static DELETE="delete";constructor(t,e){let s=[n.NEW,n.CHANGE,n.DELETE];if(!s.includes(t))throw new Error(`Invalid event type: ${t}. Valid types are ${s.join(", ")}.`);super(t,{detail:e,bubbles:!0})}static new(t){return new n(n.NEW,t)}static delete(t){return new n(n.DELETE,t)}static change(t,e){return new n(n.CHANGE,{target:t,delta:e})}};var y=class extends HTMLElement{bindings={};static tagName=null;static template=null;#t;#s=()=>this.render();#i=()=>this.remove();get model(){return this.#t}set model(t){if(this.#t&&(this.#t.removeEventListener(r.CHANGE,this.#s),this.#t.removeEventListener(r.DELETE,this.#i)),!t instanceof m)throw new Error("The model must be an instance of Model.");this.#t=t,this.#t&&(this.#t.addEventListener(r.CHANGE,this.#s),this.#t.addEventListener(r.DELETE,this.#i))}#e;#n=()=>this.render();get collection(){return this.#e}set collection(t){if(this.#e&&(this.#e.removeEventListener(r.NEW,this.#n),this.#e.removeEventListener(r.CHANGE,this.#n)),!t instanceof d)throw new Error("The collection must be an instance of Collection.");this.#e=t,this.#e&&(this.#e.addEventListener(r.NEW,this.#n),this.#e.addEventListener(r.CHANGE,this.#n)),this.render()}render(){f.bind(this,this.bindings)}connectedCallback(){if(this.constructor.template){this.innerHTML="";let t=f.clone(this.constructor.template);this.appendChild(t)}this.render()}disconnectedCallback(){this.model=null,this.collection=null}static define(t){this.tagName=t,customElements.define(t,this)}static new(t,e){if(!this.tagName)throw new Error("Component has no tagName defined. Call .define(tagName) first.");let s=document.createElement(this.tagName);return t?s.model=t:e&&(s.collection=e),s}};var d=class n extends EventTarget{#t=[];#s=t=>this.dispatchEvent(r.change(t.detail.target,t.detail.delta));constructor(t,...e){super(),this.modelClass=t,e.forEach(s=>this.push(s)),t.addEventListener("new",s=>this.push(s.detail))}fromArray(t){return t.forEach(e=>this.push(e)),this}push(t){t instanceof this.modelClass||(t=new this.modelClass(t)),!this.includes(t)&&(t.addEventListener("delete",e=>this.remove(t)),t.addEventListener("change",this.#s),this.#t.push(t),this.dispatchEvent(r.new(t)))}remove(t){let e=this.indexOf(t);e!==-1&&(t.removeEventListener("change",this.#s),this.splice(e,1),this.dispatchEvent(r.delete(t)))}sort(t){return this.#t.sort(t)}indexOf(t,e){return this.#t.indexOf(t,e)}includes(t,e){return this.#t.includes(t,e)}forEach(t){this.#t.forEach(t)}map(t){return new n(this.modelClass).fromArray(this.#t.map(t))}filter(t){return new n(this.modelClass).fromArray(this.#t.filter(t))}splice(t,e){return new n(this.modelClass).fromArray(this.#t.splice(t,e))}flatMap(t){return new n(this.modelClass).fromArray(this.#t.flatMap(t))}};return S(D);})();
